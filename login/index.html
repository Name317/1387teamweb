<html>
    <head>
        <meta charset = "UTF-8">
        <title>1387网-登录</title>
        <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests;">
        <link href="favicon.ico" rel="icon">
        <style>
            .backgroundiv {
              background-color: #3498db;
              color: white;
              padding: 20px;
              border: 2px solid #2980b9;
              margin: 20px;
              text-align: center;
            }
            a{
              text-decoration: none;
            }
            a:hover{
              text-decoration: underline;
            }
        </style>
    </head>
    <body style="background-image: url('https://cdn.luogu.com.cn/upload/image_hosting/n958y1vp.png'); background-size: cover; background-repeat: no-repeat;">
        <input type = "button" value = "跳转回主页" onclick = "window.location.href='https://name317.github.io'">
        <hr>
        <div class = "backgroundiv">
            <h1>这里是 1387网</h1>
            <hr>
        </div>
        <br>
        <div class = "backgroundiv">
            <h2>登录</h2>
            <input type = 'input' id = 'name' placeholder = '昵称'></input>
            <br>
            <br>
            <input type = 'input' id = 'pass' placeholder = '密码'></input>
            <br>
            <br>
            <button onclick = 'bus();'>登录</button>&ensp;&ensp;&ensp;<a href = 'https://name317.github.io/1387teamweb/lange'>没有账号？去注册</a>
        </div>
        <script>
            function apt(tin,wm){
			    return '&' + tin + '=' + wm;
    		}
    		function apd(act){
				var yon = 'https://tinywebdb.appinventor.space/api?user=turbo317&secret=bb6dc299&action=' + act;
				return yon;
    		}
    		function pt(o,...args){
				var xhr = new XMLHttpRequest();
    		    var url = '';
				if (o === 'count'){
					url = apd(o);
				}
				else if (o === 'get'){
					url = apd(o) + apt('tag',args[0]);
				}
				else if (o === 'delete'){
					url = apd(o) + apt('tag',args[0]);
				}
				else if (o === 'update'){
					url = apd(o) + apt('tag',args[0]) + apt('value',args[1]);
				}
				else if (o === 'search'){
					url = apd(o) + apt('no',args[0]) + apt('count',args[1]) + apt('tag',args[2]) + apt('type',args[3]);
				}
				xhr.open("GET", url, false); 
				xhr.send();
				if (xhr.status === 200) {
				    return(xhr.responseText);
				} else {
				    return(xhr.statusText);
				}
   			};
            function bus(){
                var nad = document.getElementById("name").value;
                var dod = document.getElementById("pass").value;
				var d1 = JSON.parse(pt('get',nad + '_password'));
				var d2 = d1[nad + '_password'];
				if (d2 == dod){
					alert('登陆成功！');
					window.localStorage.setItem('nowname',nad);
				}
				else{
					alert('登陆失败！');
				}
				window.location.href = 'https://name317.github.io/1387teamweb/';
            }
        </script>
    </body>
</html>
